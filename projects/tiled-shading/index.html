<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>tiled shading comparison – simon moos</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="../../favicon.ico">
		<link rel="stylesheet" href="../../css/project.css">
	</head>
	<body>

		<header>
			<h1><a href="/">Simon Moos</a></h1>
		</header>

		<section>

			<h1>
				Tiled Shading Comparison
				<small>2017-XX-XX – Simon Moos</small>
			</h1>

			<canvas id="canvas"></canvas>
			<button type="button" id="fullscreen-btn" onclick="goFullscreen()">Go Fullscreen</button>
			<div>
				<p style="margin-bottom: 0;" id="cpu-time-display">CPU time</p>
				<p id="gpu-time-display">GPU time</p>
				<div><input type="radio" name="renderMode" value="forward" onclick="renderModeChanged(this)" checked="checked"/> Forward Rendering (one pass per light)</div>
				<div><input type="radio" name="renderMode" value="forward-one-pass" onclick="renderModeChanged(this)"/> Forward Rendering (one pass for all lights)</div>
				<div><input type="radio" name="renderMode" value="tiled-shading" onclick="renderModeChanged(this)"/> Tiled Shading</div>
			</div>

			<script type="x-shader/x-vertex" id="forward-ambient-vs">
				#version 300 es
				layout(location = 0) in vec3 position;
				layout(location = 2) in mat4 modelMatrix;
				uniform mat4 viewProjection;
				void main() {
					gl_Position = viewProjection * modelMatrix * vec4(position, 1.0);
				}
			</script>
			<script type="x-shader/x-fragment" id="forward-ambient-fs">
				#version 300 es
				precision highp float;
				out vec4 fragColor;
				void main() {
					fragColor = vec4(vec3(0.10), 1.0);
				}
			</script>
			<script type="x-shader/x-vertex" id="forward-vs">
				#version 300 es
				layout(location = 0) in vec3 position;
				layout(location = 1) in vec3 normal;
				layout(location = 2) in mat4 modelMatrix;
				uniform mat4 viewProjection;
				smooth out vec3 worldPos;
				smooth out vec3 worldNormal;
				void main() {
					worldNormal = mat3(modelMatrix) * normal; // assumes no separate xyz-scaling!
					worldPos = vec3(modelMatrix * vec4(position, 1.0));
					gl_Position = viewProjection * modelMatrix * vec4(position, 1.0);
				}
			</script>
			<script type="x-shader/x-fragment" id="forward-fs">
				#version 300 es
				precision highp float;
				smooth in vec3 worldPos;
				smooth in vec3 worldNormal;
				uniform vec3 lightPos; // world space
				uniform vec3 lightColor;
				out vec4 fragColor;
				void main() {
					vec3 toLight = lightPos - worldPos;
					float distSquared = dot(toLight, toLight);
					float atten = 1.0 / distSquared * 6.0;
					float intensity = max(0.0, dot(normalize(worldNormal), normalize(toLight)));
					vec3 color = lightColor * intensity * atten;
					fragColor = vec4(color, 1);
				}
			</script>

			<script type="x-shader/x-vertex" id="forward-one-pass-vs">
				#version 300 es
				layout(location = 0) in vec3 position;
				layout(location = 1) in vec3 normal;
				layout(location = 2) in mat4 modelMatrix;
				uniform mat4 viewProjection;
				smooth out vec3 worldPos;
				smooth out vec3 worldNormal;
				void main() {
					worldNormal = mat3(modelMatrix) * normal; // assumes no separate xyz-scaling!
					worldPos = vec3(modelMatrix * vec4(position, 1.0));
					gl_Position = viewProjection * modelMatrix * vec4(position, 1.0);
				}
			</script>
			<script type="x-shader/x-fragment" id="forward-one-pass-fs">
				#version 300 es
				precision highp float;
				smooth in vec3 worldPos;
				smooth in vec3 worldNormal;

				struct Light {
					vec4 pos; // world space (x,y,z), w=padding
					vec4 color; // (r,g,b), a=padding
				};

				const int MAX_NUM_LIGHTS = 500;
				//layout(std140) uniform LightBlock
				//{
					uniform vec4 pos[MAX_NUM_LIGHTS]; // world space (x,y,z), w=padding
					uniform vec4 color[MAX_NUM_LIGHTS]; // (r,g,b), a=padding
					uniform int numLights;
				//};

				out vec4 fragColor;
				void main() {

					vec3 accumulatedColor = vec3(0, 0, 0);
					Light light;

					int numActiveLights = min(numLights, MAX_NUM_LIGHTS);
					for (int i = 0; i < numActiveLights; i++) {

						light.pos = pos[i];
						light.color = color[i];

						vec3 toLight = light.pos.xyz - worldPos;
						float distSquared = dot(toLight, toLight);
						float atten = 1.0 / distSquared * 6.0;
						float intensity = max(0.0, dot(normalize(worldNormal), normalize(toLight)));
						vec3 color = light.color.rgb * intensity * atten;
						accumulatedColor += color;
					}

					fragColor = vec4(accumulatedColor, 1.0);
				}
			</script>

			<h2>About</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
			<pre><code>code &amp; stuff</code></pre>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

			<h2>Other</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

			<h2>Conclusion</h2>
			<p>If you like this article/project please share it:</p>
			<p><a href="https://twitter.com/share" class="twitter-share-button" data-text="Tiled shading comparison" data-via="SimonMoos" data-lang="en" data-show-count="false">Tweet</a></p>
			<p>If you want to see and hear more from me, follow me on Twitter and GitHub:</p>
			<p>
				<a href="https://twitter.com/SimonMoos" class="twitter-follow-button" data-lang="en" data-show-count="false">Follow @SimonMoos</a>
				<iframe src="https://ghbtns.com/github-btn.html?user=Shimmen&type=follow&count=false" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
			</p>

		</section>

		<footer>
			<p>Simon Moos (c) 2017</p>
		</footer>

		<!--<script src="../picogl.min.js" charset="utf-8"></script>-->
		<script src="../picogl.js" charset="utf-8"></script>

		<script src="../gl-matrix-min.js" charset="utf-8"></script>
		<script src="../webgl-obj-loader.js" charset="utf-8"></script>
		<script src="rendering.js" charset="utf-8"></script>
		<script src="../base.js" charset="utf-8"></script>

		<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-98613739-1', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>
