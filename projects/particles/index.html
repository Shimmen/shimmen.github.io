<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>particle simulation – simon moos</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="../../favicon.ico">
		<link rel="stylesheet" href="../../css/project.css">
	</head>
	<body>

		<header>
			<h1><a href="/">Simon Moos</a></h1>
		</header>

		<section>

			<h1>
				Particle Simulation
				<small>2017-08-14 – Simon Moos</small>
			</h1>

			<canvas id="canvas"></canvas>
			<button type="button" id="fullscreen-btn" onclick="goFullscreen()">Go Fullscreen</button>
			<button type="button" id="start-sim-btn">Start simulation</button>

			<script type="x-shader/x-vertex" id="particles-vs">
				#version 300 es
				const float G = 1.0 / 30000.0;
				const float M = 0.7; // of cursor, so to speak
				layout(location = 0) in vec3 a_position;
				layout(location = 1) in vec3 a_velocity;
				uniform vec2 mousePosition;
				out vec3 tf_position;
				out vec3 tf_velocity;
				void main() {

					// simulate
					vec3 mousePos = vec3(mousePosition, 0.0);
					vec3 toMouse = mousePos - a_position;
					float r2 = max(0.01, dot(toMouse, toMouse));
					vec3 acceleration = G * M * normalize(toMouse) / r2;

					vec3 vel = a_velocity + acceleration;
					vec3 pos = a_position + vel;

					// reset xy velocity if position is outside xy (canvas) border
					vec2 margin = vec2(0.6, 0.65);
					if (pos.x <= -margin.x && dot(vel, vec3(+1, 0, 0)) < 0.0) vel.x = 0.0;
					if (pos.x >= +margin.x && dot(vel, vec3(-1, 0, 0)) < 0.0) vel.x = 0.0;
					if (pos.y <= -margin.y && dot(vel, vec3(0, +1, 0)) < 0.0) vel.y = 0.0;
					if (pos.y >= +margin.y && dot(vel, vec3(0, -1, 0)) < 0.0) vel.y = 0.0;

					// transform feedback
					tf_position = pos;
					tf_velocity = vel;

					gl_PointSize = 2.0;
					gl_Position = vec4(pos, 1.0);
				}
			</script>
			<script type="x-shader/x-fragment" id="particles-fs">
				#version 300 es
				precision highp float;
				in vec3 tf_position;
				in vec3 tf_velocity;
				uniform sampler2D heatLut;
				out vec4 fragColor;
				void main() {
					// calculate color from velocity
					float speedValue = clamp(length(tf_velocity) * 38.0, 0.15, 1.0);
					vec3 color = texture(heatLut, vec2(speedValue, 0.5)).rgb;

					// calculate alpha depending on z-distance (far away -> more faded)
					float alpha = 0.5 + 0.25 * tf_position.z;

					// premultiply alpha
					fragColor = vec4(color * alpha, alpha);
				}
			</script>

			<h2>About</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
			<pre><code>code &amp; stuff</code></pre>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

			<h2>Conclusion</h2>
			<p>If you like this article/project please share it:</p>
			<p><a href="https://twitter.com/share" class="twitter-share-button" data-text="Template message" data-via="SimonMoos" data-lang="en" data-show-count="false">Tweet</a></p>
			<p>If you want to see and hear more from me, follow me on Twitter and GitHub:</p>
			<p>
				<a href="https://twitter.com/SimonMoos" class="twitter-follow-button" data-lang="en" data-show-count="false">Follow @SimonMoos</a>
				<iframe src="https://ghbtns.com/github-btn.html?user=Shimmen&type=follow&count=false" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
			</p>

		</section>

		<footer>
			<p>Simon Moos (c) 2017</p>
		</footer>

		<script src="../picogl.min.js" charset="utf-8"></script>
		<script src="../gl-matrix-min.js" charset="utf-8"></script>
		<script src="rendering.js" charset="utf-8"></script>
		<script src="../base.js" charset="utf-8"></script>

		<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-98613739-1', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>
